\documentclass[authoryear,acmsmall,screen]{acmart}
\citestyle{acmauthoryear}

\overfullrule=1mm

\usepackage{
  % AH> I don't know how much of these are used, and for what.
  %     (needs untangling.) 
  relsize,
  enumitem,
  xspace,
  mathtools,
  multicol,
  tikz-cd,
  parskip,
  mathrsfs,
  stmaryrd,
  tikz,
  float,
  titlecaps,
  soul,
  upgreek,
  caption,
  graphicx,
  array,
  subcaption,
  % amsmath,
  % amsthm,
  % amssymb,
  bibentry,
  bibunits,
  ./sty/mathwidth,
%  ../sty/sectsty,
  ./sty/commands,
  ./sty/infer,
  ./sty/commands,
  ./sty/higher,
  ./sty/mymath
}

\usepackage{natbib}

% tikz
\usepackage{tikz}
\usepackage{tikz-cd}

\title{Recursive Rows in Rome}

\author{AH \& JGM}

\newcommand\U{\mathcal{U}}
\newcommand\J[4]{\mathcal{J} \, #1 \, #2 \, #3 \, #4}
\newcommand\Refl{\mathrm{refl}}
\renewcommand\left{\mathrm{left}}
\renewcommand\right{\mathrm{right}}
\renewcommand\Case[3]{\mathrm{case} \; #1 \; #2 \; #3}
\newcommand\Rule[1]{(\textsc{#1})}
\begin{document}

\maketitle
\section{A dependent calculus with rows and recursion}

\subsection{Syntax}

\begin{figure}[H]
\begin{smalle}
\begin{gather*}
\begin{array}{r@{\hspace{5px}}l@{\qquad}r@{\hspace{5px}}l@{\qquad}r@{\hspace{5px}}l@{\qquad}r@{\hspace{5px}}l}
  \text{Term variables} & x \; \alpha & \text{labels variables} & \ell \in \mathcal{L} %% & & \text{Labels} & \ell & \text{Directions} & d \in \Set {\Left, \Right}
\end{array}
\\[5px]
\begin{doublesyntaxarray}
  \mcl{\text{Terms}} & M, N, T & ::= & \U \mid x \\ 
  & & & & \forall \alpha \co T. N \mid \lambda x \co T. N \mid M \, N \mid \\
  & & & & \exists \alpha \co T. M \mid (\alpha \co T , M) \mid M.1 \mid M.2  \\
  & & & & \Pi \; \rho \mid M \Concat_\mu N \\
  & & & &  \Sigma \; \rho \mid M \Branch_\mu N \\
  & & & & M \equiv N \mid \Refl \mid {\J H M N P}  \\
  \mcl{\text{Rows}} & \rho &  ::= & \{ \alpha \mid \overline{\LabTy \ell M} \} \mid ... \mid \; ? \\
  \mcl{\text{Environments}} & \Gamma & ::= & \varepsilon \mid \Gamma, \alpha : T
\end{doublesyntaxarray}
\end{gather*}
\end{smalle}
\caption{Syntax}
\label{fig:syntax}
\end{figure}

\begin{figure}[H]
\small
\begin{gather*}
\fbox{$\EnvJ \Gamma$}
\\
\ib{\irule[\Rule{emp}]{ };{\EnvJ \varepsilon}}
\rsp
\ib{\irule[\Rule{var}]
          {\EnvJ \Gamma}
          {\SortJ \Gamma M \sigma};
          {\EnvJ {\Gamma, x : M}}}
\end{gather*}
\begin{gather*}
\fbox{$\TypeJ \Gamma M \sigma$} \\
\ib{\irule[\Rule{$\star$}]{};{\SortJ \Gamma \star \U}} 
\rsp
\ib{\irule[\Rule{$\top_{\star}$}] {} ; {\SortJ \Gamma \top \star}}
\rsp
\ib{\irule[\Rule{$\top_{\U}$}] {} ; {\SortJ \Gamma \top \U}}
\\
\ib{\irule[\Rule{$Var$}]{\alpha \co \sigma \in \Gamma} ; {\TypeJ \Gamma \alpha \sigma}}
\rsp
\ib{\irule[\Rule{Nat}] {} ; {\SortJ \Gamma \Nat \star}}
\rsp
\ib{\irule[\Rule{Ix}] {\SortJ \Gamma n \Nat} ; {\SortJ \Gamma {\Ix n} \star}} \\
\ib{\irule[\Rule{$\Pi$}]{\SortJ \Gamma M \sigma} {\SortJ {\Gamma, \alpha \co M}{N}{\star}};{\SortJ \Gamma {\Pi \alpha \co M. N} \star }}
\rsp
\ib{\irule[\Rule{$\Sigma$}]{\SortJ \Gamma M \sigma} {\SortJ {\Gamma, \alpha \co M}{N}{\star}};{\SortJ \Gamma {\Sigma \alpha \co M. N} \star }} \\
\ib{\irule[\Rule{$+$}]{\SortJ \Gamma M \star}{\SortJ \Gamma N \star};{\SortJ \Gamma {M + N} {\star}}}
\rsp
\ib{\irule[\Rule{$\equiv$}]{\SortJ \Gamma {M_1} {N_1}} {\SortJ \Gamma {N_1} {\star}} {\SortJ \Gamma {M_2} {N_2}} {\SortJ \Gamma {N_2} {\star}} ; {\SortJ \Gamma {{M_1} \equiv {M_2}} {\star}}}
\end{gather*}

% \ib{\irule{};{}}
\begin{gather*}
\fbox{$\TypeJ \Gamma M N$} \\
\ib{\irule[\Rule{$Var$}]{x \co M \in \Gamma} ; {\TypeJ \Gamma x M}} 
\rsp
\ib{\irule[\Rule{$\tt$}]{};{\TypeJ \Gamma {\tt} \top}} 
\\
\ib{\irule[\Rule{$\Zero$}]{};{\TypeJ \Gamma \Zero \Nat}} 
\rsp
\ib{\irule[\Rule{$\Suc{}$}]{\TypeJ \Gamma n \Nat};{\TypeJ \Gamma {\Suc \, n} \Nat}} 
\rsp
\\
\ib{\irule[\Rule{$\FZero$}]{{\TypeJ \Gamma n \Nat}};{\TypeJ \Gamma \FZero {\Ix (\Suc \, n)}}} 
\rsp
\ib{\irule[\Rule{$\FSuc{}$}]{\TypeJ \Gamma n \Nat}{\TypeJ \Gamma i {\Ix n}};{\TypeJ \Gamma {\FSuc \, i} {\Ix {(\Suc \, n)}}}} 
\\
\ib{\irule[\Rule{$\I\Pi$}]
  {\SortJ \Gamma T \sigma}
  {\TypeJ {\Gamma , x \co T} {M} {N}};
  {\TypeJ \Gamma {\lambda x \co T. M} {\Pi (x \co T). N}}}
\rsp
\ib{\irule[\Rule{$\E\Pi$}]
    {\TypeJ \Gamma M {\Pi(x \co T_1). T_2}} {\TypeJ \Gamma N {T_1}};
    {\TypeJ \Gamma {M \, N} T_2[N/x]}}
\\
 \ib{\irule[\Rule{$\I\Sigma$}]
      {\TypeJ {\Gamma}{M}{T_1}}
      {\TypeJ {\Gamma} {N} {T_2[M/x]}};
      {\TypeJ \Gamma {(M \co T_1, N)} {\Sigma (x \co T_1). T_2}}}
\rsp
 \ib{\irule [\Rule{$\E\Sigma_{1}$}]
     {\TypeJ \Gamma M {\Sigma (x \co T_1). T_2}}; 
     {\TypeJ \Gamma {M.1} T_1}}
\rsp
 \ib{\irule [\Rule{$\E\Sigma_{2}$}]
     {\TypeJ \Gamma M {\Sigma (x \co T_1). T_2}}; 
     {\TypeJ \Gamma {M.2} T_2[M.1/x]}}
\\
\ib{
  \irule [\Rule{$\I\equiv$}]
  {\TypeJ \Gamma M \sigma};
  {\TypeJ \Gamma {\Refl} {M \equiv M}}}
\rsp
\ib{
  \irule [\Rule{conv}]
  {\TypeJ \Gamma M T_1}{\TypeJ \Gamma {T_1 = T_2} {\sigma}};
  {\TypeJ \Gamma M T_2}}
\\
\ib{
  \irule [\Rule{$\E\equiv$}]
      {\mathlarger{\mathlarger{\mathlarger{\substack{ 
        {\TypeJ \Gamma {P} {T_1 \equiv T_2}} \\
        {\Gamma \vdash M : T_1} \\
        {\Gamma \vdash N : T_1} \\
        {\TypeJ {\Gamma, x \co T_1, y \co T_1, p \co x \equiv y} {T} {\star}} \\
        {\TypeJ {\Gamma , z \co T_1} H {T[z/x, z/y, \Refl/p]} }}}}}}
  ;
  {\TypeJ \Gamma {\J H M N P} {T[M/x,N/y,P/p]}}}
\end{gather*}
\caption{Context formation and typing rules for \IX{} terms}
\label{fig:IxRules}
\end{figure}

 Let the meta-syntax $\tau$ denote both sort and term.

\begin{figure}[H]
\small
\begin{gather*}
\fbox{$\TypeJ \Gamma {M = N} \sigma$} \\
\ib{
  \irule[\erule{refl}]
  {\TypeJ \Gamma M \sigma} 
  ;
  {\TypeJ \Gamma {M = M} \sigma}}
\rsp
\ib{
  \irule[\erule{sym}]
  {\TypeJ \Gamma {N = M} \sigma} 
  ;
  {\TypeJ \Gamma {M = N} \sigma}}
\rsp
\ib{
  \irule[\erule{trans}]
  {\TypeJ \Gamma {M = P} \sigma} {{\TypeJ \Gamma {P = N} \sigma}}
  ;
  {\TypeJ \Gamma {M = N} \sigma}}
\end{gather*}
\begin{gather*}
\fbox{$\TypeJ \Gamma {M = N} T$} \\
\ib{
  \irule[\crule{refl}]
  {\TypeJ \Gamma M T} 
  ;
  {\TypeJ \Gamma {M = M} T}}
\rsp
\ib{
  \irule[\crule{sym}]
  {\TypeJ \Gamma {N = M} T} 
  ;
  {\TypeJ \Gamma {M = N} T}}
\rsp
\ib{
  \irule[\crule{trans}]
  {\TypeJ \Gamma {M = P} T} {{\TypeJ \Gamma {P = N} T}}
  ;
  {\TypeJ \Gamma {M = N} T}}
\end{gather*}
\caption{Definitional equality \& computational laws}
\label{fig:IxDefnEq}
\end{figure}




\end{document}

