\newcommand\appref[1]{Appendix~\ref{app:#1}}
\newcommand\secref[1]{Section~\ref{sec:#1}}
\newcommand\Secref[1]{\S\ref{sec:#1}}
\newcommand\figref[1]{Figure~\ref{fig:#1}}
\newcommand\defref[1]{Definition~\ref{def:#1}}
\newcommand\thmref[1]{Theorem~\ref{thm:#1}}
\newcommand\lemref[1]{Lemma~\ref{lem:#1}}
\renewcommand\eqref[1]{(\ref{eq:#1})}
\newcommand\Eqref[1]{Equation~\eqref{#1}}


%%% JHM: more notation
%%% I think terms with definitional force, either in running text, or definitions,
%%% should toggle \emph status to draw attention to themselves...
\newcommand{\defemph}[1]{\emph{#1}}%%%{{#1}} for status quo ante behaviour

%% Syntax - judgments

\newcommand\ib[1]{\infbox{#1}}
\newcommand\isp{\hspace{\infskip}}
\newcommand\rsp{\hspace{1.5\infskip}}
\newcommand\mrule[1]{\textsc{(#1$^\text{\textsc{m}}$)}}
\newcommand{\I}[1]{\ensuremath{\mathord{#1}}\!~I}
\newcommand{\E}[1]{\ensuremath{\mathord{#1}}\!~E}
\newcommand\Set[1]{\ensuremath{\{#1\}}}
\newcommand\Tuple[1]{\ensuremath{\langle #1 \rangle}}
\newcommand\pto{\ensuremath{\rightharpoonup}}

\newcommand{\trto}{\rightsquigarrow}
\newcommand{\tr}[1]{(#1)^\bullet}
\newcommand\trnp[1]{#1^\bullet}

%% Syntax - types

\def\circleit#1{{\setbox0=\hbox{$\bigcirc$}\setbox1=\hbox{#1}%
    \dimen10=\wd0 \advance\dimen10 by \wd1\divide\dimen10 by 2
    \dimen12=\ht0 \advance\dimen12 by \dp0
    \advance\dimen12 by-\ht1 \advance\dimen12 by-\dp1
    \divide\dimen12 by 2 \advance\dimen12 by-\dp0 \advance\dimen12 by \dp1
    \hbox to \wd0{\lower\dimen12\copy0\kern-\dimen10\copy1\hss}}}
\newcommand\oleq{\circleit{$\leq$}}

\newcommand{\then}{\Rightarrow}
\newcommand{\LeqP}[3][]{\ifthenelse{\equal{#1}{}}{#2 \lesssim #3}{#2 \mathbin{\lesssim_{#1}} #3}}
\newcommand{\RowPlusP}[3]{#1 \cdot #2 \sim #3}
\newcommand{\RowPlus}[2]{#1 \cdot #2}
\newcommand\Rowlr[1]{\left\{#1\right\}}
\newcommand{\Lab}[1]{\ensuremath{\mathtt{#1}}}
\newcommand{\LabTy}[2]{\Lab{#1} : #2}
\newcommand{\Row}[2]{\LabTy{#1}{#2}}
\newcommand\Rhow[2]{\Hs{#1} : #2}
\newcommand\EllTy[2]{\LabTy {\mathit{\ell_{#1}}} {#2}}

%% Syntax - terms

\newcommand{\App}{\,}
\newcommand{\LabTerm}[2]{\Lab{#1} \triangleright #2}
\newcommand{\row}[2]{\LabTerm{#1}{#2}}
\newcommand\rhow[2]{\Hs{#1} \triangleright #2}
\newcommand{\Unlabel}[2]{#1 / \Lab{#2}}
\newcommand{\Prj}[2][]{\ifthenelse{\equal{#1}{}}{\mathsf{prj}\,#2}{\mathsf{prj}_{#1}\,#2}}
\newcommand{\PrjS}[2][]{\mathsf{prj}_{\triangleright}}
\newcommand{\Dir}{d}
\newcommand{\Concat}{\mathbin{\star}}
\newcommand{\Inj}[2]{\mathsf{inj} \, {#1} \, #2}
\newcommand{\InjS}{\mathsf{inj}_{\triangleright}}
\newcommand{\Branch}{\mathbin{\triangledown}}
\newcommand{\Fork}{\mathbin{\triangle}}
\newcommand\Lacks[2]{\ensuremath{#1 \backslash #2}}

%% Target language syntax

\newcommand\TLang{\ensuremath{\mathrm{F}^{\otimes\oplus}}\xspace}
\newcommand{\FPrj}[2]{\mathsf{\pi}_{#1}\,#2}
\newcommand{\FInj}[2]{\mathsf{\iota}_{#1}\,#2}
\newcommand{\FCase}[2]{\mathsf{case}\,#1\,\{#2\}}
\newcommand{\Type}[1]{#1\;\mathsf{type}}
\newcommand\Hole{\boxempty}
\newcommand\Inst[2]{#1[#2]}

% Haskell listings
\usepackage{listings}
\lstloadlanguages{Haskell}
\lstset{
  xleftmargin=\parindent,
  basicstyle=\ttfamily\small,
  keepspaces=true,
  keywordstyle=\underbar,
  numberstyle=\tiny,
  flexiblecolumns=false,
  basewidth={0.5em,0.45em},
  morekeywords={instance, class, if, where, data, then, else, type, case, of, require, linear, primitive},
  morecomment=[l]{--},
  mathescape=true,
  literate={+}{{$+$}}1 {/}{{$/$}}1 {*}{{$*$}}1 {=}{{$=$}}1
    {/=}{{$\not=$}}2
    {>}{{$>$}}1 {<}{{$<$}}1 {\\}{{$\lambda$}}1
    {\\\\}{{\char`\\\char`\\}}1 {\\"}{{\char`\\"}}2
    {->}{{$\to$}}2 {-@}{{$\lto$}}2 {>=}{{$\geq$}}2 {<-}{{$\leftarrow$}}2
    {<=}{{$\leq$}}2 {=>}{{$\Rightarrow$}}2
    {\ .\ }{{$\circ$}}3
    {>>}{{>>}}2 {>>=}{{>>=}}2
    {|}{{$\mid$}}1
    {...}{{$\dots$}}3
    {@}{{$@$}}1 {@!}{{$@^!$}}1 {-!>}{{$\uto$}}2 {:+:}{{$\oplus$}}1
    {.<.}{{$\sqsubseteq$}}1 {//}{{$\div$}}1
}
%\lstnewenvironment{code}{}{}
%\lstnewenvironment{codef}{\lstset{basicstyle=\ttfamily\small,xleftmargin=1.5em}}{}

\newcommand\Rose{\textsc{Rose}\xspace}
\newcommand{\Remy}{R\'emy\xspace}



\newenvironment{syntaxarray}%
{\begin{array}[t]{@{}lr@{\hspace{5px}}r@{\hspace{5px}}l@{}}}%
{\end{array}\ignorespacesafterend}

\newenvironment{syntax}%
{\[\begin{syntaxarray}}%
{\end{syntaxarray}\]\ignorespacesafterend}

\newenvironment{doublesyntaxarray}%
  {\begin{array}{l@{}lr@{\hspace{5px}}c@{\hspace{5px}}l@{\hspace{15px}}lr@{\hspace{5px}}c@{\hspace{5px}}l}}%
  {\end{array}\ignorespacesafterend}

\newenvironment{doublesyntax}%
  {\[\begin{doublesyntaxarray}}
  {\end{doublesyntaxarray}\]\ignorespacesafterend}


\newcommand\mcl[1]{\multicolumn{2}{l}{#1}}
\newcommand\mcr[1]{\multicolumn{2}{r}{#1}}

%%% grey shading
%% SL: this needs to be quite dark to show up at all on a printer
\definecolor{shade}{RGB}{191,191,191}
\newcommand\shade[1]{\setlength{\fboxsep}{0pt}\colorbox{shade}{\ensuremath{#1}}}

\newcommand{\commentbox}[3]{{\ifcomments \par\noindent\small\color{#1} \framebox{\parbox{\dimexpr\linewidth-2\fboxsep-2\fboxrule}{\textbf{#2:} #3}} \fi}}
\newcommand{\todo}[1]{\commentbox{RoyalPurple}{TODO}{#1}}
\newcommand{\todoitems}[1]{\todo{\begin{itemize}#1\end{itemize}}}
\newcommand{\JGM}[1]{\commentbox{OliveGreen}{JGM}{#1}}
\newcommand{\JHM}[1]{\commentbox{RawSienna}{JHM}{#1}}
\newcommand{\ADE}[1]{\commentbox{DarkSalmon}{ADE}{#1}}
\newcommand{\RA}[1]{\commentbox{Red}{Reviewer A}{\emph{#1}}}
\newcommand{\RB}[1]{\commentbox{Red}{Reviewer B}{\emph{#1}}}
\newcommand{\RC}[1]{\commentbox{Red}{Reviewer C}{\emph{#1}}}
\newcommand{\RD}[1]{\commentbox{Red}{Reviewer D}{\emph{#1}}}
\newcommand{\AH}[1]{\commentbox{black}{AH}{#1}}
\newcommand{\AHRev}[1]{{\color{SteelBlue} #1}}
\newcommand{\AHFN}[1]{\footnote{\AHRev{#1}}}
\newcommand{\citeme}{{\color{RoyalPurple}[\textbf{TODO}]}}
\newcommand{\todots}{{\color{RoyalPurple}\large\dots}}
\newcommand\fixme[1]{\textcolor{red}{#1}}

% Colors for *Created* and *Updated* and updated changes, resp.
\newcommand\ColorC{\ifcomments Blue\else black\fi}
\newcommand\ColorU{\ifcomments Purple\else black\fi}
\newcommand\ColorNvm{\ifcomments Orange\else black\fi}
\newcommand\ruleAdded[1]{{\color{\ColorC} #1}}
\newcommand\ruleUpdated[1]{{\color{\ColorU} #1}}
\newcommand\ruleNvm[1]{{\color{\ColorNvm} #1}}

\long\def\dontshow#1{} %%%

\newcommand\RO[1][]{\textrm{R$\omega\ifthenelse{\equal{#1}{}}{}{(#1)}$}\xspace}
\newcommand\ROmu{\textrm{R$^{\mu}_{\omega}$}\xspace}
\newcommand\Rome{\textrm{$\RO\mu$}\xspace}
\newcommand\FO{\textrm{F$\omega$}\xspace}
\newcommand\Fome{\textrm{F$\omega\mu$}\xspace}
\newcommand\SF{\textrm{SF{$_2$}}\xspace}

\newcommand\co{\mathbin{:}}
\newcommand\kay{k}   % Sort out script k
\newcommand\Disjoint{\mathrel{\#}}
\newcommand\Deriv[1][]{\ifthenelse{\equal{#1}{}}{\mathcal{D}}{\mathcal{D}_{#1}}}

%% Syntax


\newcommand\TypeK[1][]{\star_{#1}}
\newcommand\LabK{\mathsf{L}}
\newcommand\RowK[1]{\mathsf{R}^{#1}}

\newcommand\Sing[1]{\lfloor #1 \rfloor}
\newcommand\TyC[1]{\mathrm{#1}}
\newcommand\ExC[1]{\mathrm{#1}}


\newcommand\Bool{\TyC{Bool}}
\newcommand\Int{\TyC{Int}}
\newcommand\Double{\TyC{Double}}
\newcommand\List{\TyC{List}}

\newcommand\AppT[2]{#1 \, [#2]}
\newcommand\Lam[3]{\lambda {#1} : {#2}. {#3}}
\newcommand\TLam[3]{\Lambda {#1} : {#2}. {#3}}

\renewcommand\Concat{\mathbin{+\!\!+}}
\newcommand\Ana[1][]{\mathsf{ana}_{#1}}
\newcommand\Syn[1][]{\mathsf{syn}_{#1}}


\newcommand\Map{\ExC{map}}
\newcommand\Fold{\mathsf{fold}}
\newcommand\Iter{\TyC{Iter}}
\newcommand\IterM{\Iter_{\Map}}
\newcommand\IterF{\Iter_{\Fold}}
\newcommand\MapP{\Map_\Pi}
\newcommand\MapS{\Map_\Sigma}
\newcommand\FoldP{\Fold}
%\newcommand\FoldS{\Fold_\Sigma}

\newcommand\labrule[2]{(\textsc{#1-#2})}
\newcommand\crule[1]{\labrule c {#1}}
\newcommand\krule[1]{\labrule k {#1}}
\newcommand\prule[1]{\labrule p {#1}}
\newcommand\eqrule[1]{\labrule e {#1}}
\newcommand\entrule[1]{\labrule n {#1}}
\newcommand\entsrule[2]{\labrule {n$_{#1}$} {#2}}
\newcommand\trule[1]{\labrule t {#1}}
\newcommand\erule[1]{\labrule e {#1}}
\newcommand\erulec[1]{\erule{$\xi_{#1}$}}
\newcommand\esrule[2]{\labrule {e$_{#1}$} {#2}}

\newcommand\EntJ[2]{#1 \Vdash #2}
\newcommand\EntJS[3]{#2 \Vdash_{#1} #3}
\newcommand\EnvJ[1]{\vdash #1}
\newcommand\KindJ[3]{#1 \vdash #2 : #3}
\newcommand\KindJS[4]{#2 \vdash_{#1} #3 : #4}
\newcommand\PredJ[2]{#1 \vdash #2}
\newcommand\TypeJ[3]{#1 \vdash #2 : #3}
\newcommand\EqvJ[2]{#1 \equiv #2}
\newcommand\EqvJS[3]{#2 \equiv_{#1} #3}
\newcommand\Thy{\mathcal{T}}
\newcommand\Mty{\mathsf{m}}
\newcommand\Sty{\mathsf{s}}
\newcommand\Cty{\mathsf{c}}

\newcommand\rrule[1]{[\textsc{#1}]}
\newcommand\Red{\longrightarrow}
\newcommand\Reds{\longrightarrow^\star}
\newcommand\Crash{\mbox{\blitza}}
\newcommand\Or{\curlyvee}

% Alex
\newcommand\Case[2]{\paragraph{Case #1} We have a derivation of the form: #2}
\newcommand\Ni{\noindent}
\newcommand\Sem[1]{\llbracket #1 \rrbracket}
\newcommand\Seme[1]{\Sem{#1}_e}
\newcommand\Semt[1]{\Sem{#1}_t}
\newcommand\Sempe[1]{\Sem{#1}_{pe}}
\newcommand\Semke[1]{\Sem{#1}_{ke}}

\newenvironment{smalle}
  {\begingroup\small}
  {\endgroup\ignorespacesafterend}

\newcommand\KFam[2]{#1^{(#2)}}

\newcommand\Poplmark{\textsc{Poplmark}}
\newcommand\PoplmarkReloaded{\textsc{Poplmark: Reloaded}}

\newcommand\citeg[1]{\citeauthor{#1}'s}

\newcommand\Tt[1]{\texttt{#1}}
\newcommand\Float{\Tt{Float}}
\renewcommand\Int{\Tt{Int}}
\newcommand\Nat{\Tt{Nat}}
\newcommand\String{\Tt{String}}
\renewcommand\Bool{\Tt{Bool}}
\renewcommand\Prj{\Tt{prj}}
% \newcommand\note[1]{[\textit{Note: #1}]}
\newcommand\Note[1]{\commentbox{black}{Note}{#1}}
\newcommand\Alert[1]{\commentbox{red}{Alert}{#1}}
\newcommand\Warning[1]{\commentbox{orange}{Warning}{#1}}
\newcommand\ThreeDPoint{\Tt{3dPoint}\xspace}
\newcommand\TwoDPoint{\Tt{2dPoint}\xspace}


% \renewcommand{\labelenumi}{(\alph{enumi}).}
% \renewcommand{\labelenumiii}{\alph{enumi}.\arabic{enumii}.\arabic{enumiii}}
% \renewcommand{\labelenumiv}{\alph{enumi}.\arabic{enumii}.\arabic{enumiii}.\arabic{enumiv}}

\newcommand\FloatJ{\Tt{float}}
\newcommand\intJ{\Tt{int}}


\newcommand\ala{\`{a} la\xspace}
\newcommand\LabelSet{\ensuremath{\mathcal{L}}}
\newcommand\BaseType{\ensuremath{\mathcal{B}}}
\newcommand\doubleplus{\mathbin{+\mkern-10mu+}}

\newcommand\Comb[3]{\ensuremath{#1 \cdot #2 \sim #3}}
\newcommand\Cont[2]{\ensuremath{#1 \lesssim #2}}
\newcommand\ContL[2]{\ensuremath{#1 \lesssim_{L} #2}}
\newcommand\ContR[2]{\ensuremath{#1 \lesssim_{R} #2}}
\newcommand\ContD[2]{\ensuremath{#1 \lesssim_{d} #2}}
\newcommand\Expr{\Tt{Expr}}

\ifstretch
\newcommand\Novel[1]{{\color{blue}#1}}
\newcommand\Extant[1]{{\color{red}#1}}
\newcommand\Mixed[1]{{\color{purple}#1}}
\newcommand\Stretch[1]{{\color{orange}#1}}
\else
\newcommand\Novel[1]{#1}
\newcommand\Extant[1]{#1}
\newcommand\Mixed[1]{#1}
\newcommand\Stretch[1]{#1}
\fi
\newcommand\Remaining[1]{{\color{blue}#1}}
\newcommand\StratRO{\ensuremath{R^{\ell}\omega}}

% \newcommand\Novel[1]{#1}
% \newcommand\Extant[1]{#1}
% \newcommand\Mixed[1]{#1}
\newcommand\IX{\textsc{Ix}}
\newcommand\Arxiv{\note{cite ArXiv}}

\renewcommand\unit{\Tt{()}}
\newcommand\Unit{\ensuremath{\top}}
\renewcommand\L{\mathcal{L}}
\newcommand\A{\mathcal{A}}
\newcommand\In[1]{\mathrm{In}\, #1}
\newcommand\Out[1]{\mathrm{Out}\, #1}
\newcommand\Fix[1]{\mathrm{fix}\, #1}


\renewcommand\Float{\Hs{Float}}
\renewcommand\Int{\Hs{Int}}
\renewcommand\Nat{\Hs{Nat}}
\newcommand\True{\Hs{True}}
\newcommand\False{\Hs{False}}
\renewcommand\String{\Hs{String}}
\renewcommand\Bool{\Hs{Bool}}
\newcommand\Contribution[2]{Contribution #1-#2}
\newcommand\Contributions[2]{Contributions #1-#2}
\newcommand\contribution[2]{#1-#2}
