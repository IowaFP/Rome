module Mix.Terms where

open import Preludes.Data
open import Data.List
open import Preludes.Relation

open import Mix.Pre.Terms

--------------------------------------------------------------------------------
-- Declare contexts and judgements.
-- (mutually recursive.)

data Context : Set
data _âŠ¢_â¦‚_ : Context â†’ Term â†’ Term â†’ Set

data Context where
  Îµ : Context
  _,_ : Context â†’ Term â†’ Context

--------------------------------------------------------------------------------
-- Lookup 
infix 4 _âˆˆ_

data _âˆˆ_ : Term â†’ Context â†’ Set where

  Z : âˆ€ {Î“ A}
      ------------------
    â†’ A âˆˆ (Î“ , A)

  S : âˆ€ {Î“ A B}
    â†’ A âˆˆ Î“
      ------------------
    â†’ A âˆˆ (Î“ , B)

data âŠ¢Context : Context â†’ Set where
  Îµ : âŠ¢Context Îµ
  _,_ : âˆ€ {Ï„}{Î”}{M} â†’ 
          âŠ¢Context Î” â†’ 
          Î” âŠ¢ M â¦‚ Ï„ â†’ 
          ----------------------------
          âŠ¢Context (Î” , Ï„)
private
  variable
    Î” : Context 

--------------------------------------------------------------------------------
-- Typing judgements.

data _âŠ¢_â¦‚_ where
  â˜… : Î” âŠ¢ â˜… â¦‚ ğ“¤
  --
  âŠ¤ : âˆ€ {Ïƒ} â†’ Sort Ïƒ â†’  Î” âŠ¢ âŠ¤ â¦‚ Ïƒ
  tt : Î” âŠ¢ tt â¦‚ âŠ¤
  --
  varZ : âˆ€ {Ï„}  â†’ (Î” , Ï„) âŠ¢ varZ â¦‚ Ï„
  varS : âˆ€ {Ï„ Ï… n} â†’
            Î” âŠ¢ n â¦‚ Ï„
         â†’ (Î” , Ï…) âŠ¢ varS n â¦‚ Ï„
  --
  Nat : Î” âŠ¢ Nat â¦‚ â˜…
  Zero : Î” âŠ¢ Zero â¦‚ Nat
  Suc : âˆ€ {n} â†’ Î” âŠ¢ n â¦‚ Nat â†’ Î” âŠ¢ Suc n â¦‚ Nat
  --
  Ix  : âˆ€ {n} â†’ Î” âŠ¢ n â¦‚ Nat â†’ Î” âŠ¢ Ix n â¦‚ â˜…
  --
  FZero : âˆ€ {n} â†’ Î” âŠ¢ Ix n â¦‚ â˜… â†’ Î” âŠ¢ FZero â¦‚ Ix n
  FSuc  : âˆ€ {n} â†’ Î” âŠ¢ Ix n â¦‚ â˜… â†’ Î” âŠ¢ FSuc n â¦‚ Ix (Suc n) 
  --
  Î  : âˆ€ {Ï„ Ï… Ïƒ Ïƒ'} â†’ -- {_ : True (sort? Ïƒ)}
        (Î” âŠ¢ Ï„ â¦‚ Ïƒ)   â†’   (Î” , Ï„) âŠ¢ Ï… â¦‚ Ïƒ' â†’
        -------------------------------------------
        Î” âŠ¢ (Î  Ï„ Ï…) â¦‚ Ïƒ'
  `Î» : âˆ€ {Ï„ Ï… Ïƒ M} â†’ 
         Î” âŠ¢ Ï„ â¦‚ Ïƒ   â†’   (Î” , Ï„) âŠ¢ (rename M) â¦‚ Ï…  â†’ 
         ---------------------------------------------------
         Î” âŠ¢ `Î» Ï„ M â¦‚ Î  Ï„ Ï… 
  _Â·_ : âˆ€ {Ï„ Ï… M N} â†’ Î” âŠ¢ M â¦‚ Î  Ï„ Ï… â†’ Î” âŠ¢ N â¦‚ Ï„  â†’ Î” âŠ¢ M Â· N â¦‚ Ï…
  --
  Î£ : âˆ€ {Ï„ Ï… Ïƒ Ïƒ'} â†’ -- {_ : True (sort? Ïƒ)}
        Î” âŠ¢ Ï„ â¦‚ Ïƒ   â†’   (Î” , Ï„) âŠ¢ Ï… â¦‚ Ïƒ' â†’ 
        ------------------------------------------
        Î” âŠ¢ (Î£ Ï„ Ï…) â¦‚ Ïƒ'
  âŸª_â¦‚_,_âŸ« : âˆ€ {Ï„ Ï… Ïƒ Ïƒâ‚ Ïƒâ‚‚} â†’ 
            (Î” âŠ¢ Ï„ â¦‚ Ïƒâ‚)   â†’   (t : Î” âŠ¢ Ïƒâ‚ â¦‚ Ïƒâ‚‚)   â†’   (Î” , Ïƒâ‚) âŠ¢ Ï… â¦‚ Ïƒ â†’ 
            ----------------------------------------------------------------
            Î” âŠ¢ âŸª Ï„ â¦‚ Ïƒâ‚ , Ï… âŸ« â¦‚ Î£ Ïƒâ‚ Ïƒ
  fst : âˆ€ {Ï„ M Ïƒ} â†’ Î” âŠ¢ M â¦‚ Î£ Ï„ Ïƒ â†’ Î” âŠ¢ (fst M) â¦‚ Ï„
  snd : âˆ€ {Ï„ M Ïƒ} â†’ (s : Î” âŠ¢ M â¦‚ Î£ Ï„ Ïƒ) â†’ Î” âŠ¢ (snd M) â¦‚ Ïƒ
