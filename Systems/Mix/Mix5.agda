module Mix.Mix5 where

open import Preludes.Data
open import Data.List
open import Preludes.Relation

open import Data.Nat using (_âŠ”_)

--------------------------------------------------------------------------------
-- Sorts

data Sort : Set where
  ğ“¤ : Sort
  â˜…  : Sort

-- =============================================================================
-- Terms, i.e., the untyped syntax.
-- =============================================================================


data Term : Set where
  â˜… : Term
  --
  var : â„• â†’ Term
  -- -- 
  Nat  : Term
  Zero : Term
  Suc  : Term â†’ Term
  --
  Ix   : Term â†’ Term
  FZero : Term
  FSuc : Term â†’ Term
  --
  âŠ¤ : Term
  tt : Term
  
  Î  : Term â†’ Term â†’ Term
  `Î» : Term â†’ Term â†’ Term
  _Â·_ : Term â†’ Term â†’ Term
  
  Î£ : (Ï„ : Term) â†’ Term â†’ Term
  âŸª_â¦‚_,_âŸ« : Term â†’ Term â†’ Term â†’ Term
  fst : Term â†’ Term
  snd : Term â†’ Term
  --
  _Or_ : Term â†’ Term â†’ Term
  left : Term â†’ Term
  right : Term â†’ Term
  case_of[_]or[_] : Term â†’ Term â†’ Term â†’ Term
  --
  _~_ : Term â†’ Term â†’ Term
  refl : Term
  Sub : Term â†’ Term â†’ Term

-- =============================================================================
-- Formation and typing rules. 
-- =============================================================================
--------------------------------------------------------------------------------
-- Declare contexts and judgements.
-- (mutually recursive.)
data Context : Set
data _âŠ¢_â¦‚â‚›_ : Context â†’ Term â†’ Sort â†’ Set
data _âŠ¢_â¦‚_ : Context â†’ Term â†’ Term â†’ Set

data Context where
  Îµ : Context
  _,_ : âˆ€ {M}{Ïƒ} â†’ (Î” : Context) â†’ Î” âŠ¢ M â¦‚â‚› Ïƒ â†’ Context

private
  variable
    Î” : Context 

--------------------------------------------------------------------------------
-- Sorting judgements.


data _âŠ¢_â¦‚â‚›_ where
  â˜… : Î” âŠ¢ â˜… â¦‚â‚› ğ“¤
  âŠ¤â‚€ : Î” âŠ¢ âŠ¤ â¦‚â‚› â˜…
  âŠ¤â‚ : Î” âŠ¢ âŠ¤ â¦‚â‚› ğ“¤
  -- Nat : Î” âŠ¢ Nat â¦‚â‚› â˜…
  -- Ix  : âˆ€ {n} â†’ Î” âŠ¢ n â¦‚ Nat â†’ Î” âŠ¢ Ix n â¦‚â‚› â˜…
  -- Î  : âˆ€ {Ï„ Ï… Ïƒ Ïƒ'} â†’
  --       (t : Î” âŠ¢ Ï„ â¦‚â‚› Ïƒ)   â†’   (Î” , t) âŠ¢ Ï… â¦‚â‚› Ïƒ' â†’
  --       -------------------------------------------
  --       Î” âŠ¢ (Î  Ï„ Ï…) â¦‚â‚› Ïƒ'
  -- Î£ : âˆ€ {Ï„ Ï… Ïƒ Ïƒ'} â†’ -- {_ : True (sort? Ïƒ)}
  --       (t : Î” âŠ¢ Ï„ â¦‚â‚› Ïƒ)   â†’   (Î” , t) âŠ¢ Ï… â¦‚â‚› Ïƒ' â†’ 
  --       ------------------------------------------
  --       Î” âŠ¢ (Î£ Ï„ Ï…) â¦‚â‚› Ïƒ'

--------------------------------------------------------------------------------
-- Typing Judgments.

data _âŠ¢_â¦‚_ where
  --
  tt : Î” âŠ¢ tt â¦‚ âŠ¤
  --
  -- varZ : âˆ€ {Ï„ Ïƒ} {âŠ¢Ï„ : Î” âŠ¢ Ï„ â¦‚ Ïƒ}  â†’ (Î” , âŠ¢Ï„) âŠ¢ (var 0) â¦‚ Ï„
  -- varS : âˆ€ {Ï„ Ïƒ Ï…}{n} {âŠ¢Ï… : Î” âŠ¢ Ï… â¦‚ Ïƒ} â†’
  --           Î” âŠ¢ (var n) â¦‚ Ï„
  --        â†’ (Î” , âŠ¢Ï…) âŠ¢ (var (suc n)) â¦‚ Ï„
  --
  -- Zero : Î” âŠ¢ Zero â¦‚ Nat
  -- Suc : âˆ€ {n} â†’ Î” âŠ¢ n â¦‚ Nat â†’ Î” âŠ¢ Suc n â¦‚ Nat
  -- --
  -- FZero : âˆ€ {n} â†’ Î” âŠ¢ Ix n â¦‚ â˜… â†’ Î” âŠ¢ FZero â¦‚ Ix n
  -- FSuc  : âˆ€ {n} â†’ Î” âŠ¢ Ix n â¦‚ â˜… â†’ Î” âŠ¢ FSuc n â¦‚ Ix (Suc n) 
  -- --
  -- -- `Î» : âˆ€ {Ï„ Ï… Ïƒ M} â†’ (t : Î” âŠ¢ Ï„ â¦‚ Ïƒ) â†’ (Î” , t) âŠ¢ (rename M) â¦‚ Ï…  â†’ Î” âŠ¢ `Î» Ï„ M â¦‚ Î  Ï„ Ï… 
  -- _Â·_ : âˆ€ {Ï„ Ï… M N} â†’ Î” âŠ¢ M â¦‚ Î  Ï„ Ï… â†’ Î” âŠ¢ N â¦‚ Ï„  â†’ Î” âŠ¢ M Â· N â¦‚ Ï…
  -- --
  -- -- âŸª_â¦‚_,_âŸ« : âˆ€ {Ï„ Ï… Ïƒ Ïƒâ‚ Ïƒâ‚‚} â†’ (Î” âŠ¢ Ï„ â¦‚ Ïƒâ‚) â†’ (t : Î” âŠ¢ Ïƒâ‚ â¦‚ Ïƒâ‚‚) â†’ (Î” , t) âŠ¢ Ï… â¦‚ Ïƒ â†’ Î” âŠ¢ âŸª Ï„ â¦‚ Ïƒâ‚ , Ï… âŸ« â¦‚ Î£ Ïƒâ‚ Ïƒ
  -- fst : âˆ€ {Ï„ M Ïƒ} â†’ Î” âŠ¢ M â¦‚ Î£ Ï„ Ïƒ â†’ Î” âŠ¢ (fst M) â¦‚ Ï„
  -- snd : âˆ€ {Ï„ M Ïƒ} â†’ (s : Î” âŠ¢ M â¦‚ Î£ Ï„ Ïƒ) â†’ Î” âŠ¢ (snd M) â¦‚ Ïƒ

-- postulate
--   weaken : âˆ€ {Î”} {Ï„ Ï…} {Îºâ‚ Îºâ‚‚} â†’ {u : Î” âŠ¢ Ï… â¦‚ Îºâ‚} â†’ Î” âŠ¢ Ï„ â¦‚ Îºâ‚‚ â†’  (Î” , u) âŠ¢ Ï„ â¦‚ Îºâ‚‚

-- -- =============================================================================
-- -- Translating RÏ‰.  
-- -- =============================================================================

module RÎ¼ where
 open import Rome.Kinds.Syntax public
 open import Rome.Types.Syntax public
 open import Rome.Terms.Syntax public
 open import Rome.Entailment.Syntax public

open RÎ¼.Kind
open RÎ¼.KEnv
open RÎ¼.Type
open RÎ¼.TVar
open RÎ¼.Term

Row : Term â†’ Term
Row s = Î£ Nat (Î  (Ix (var 0)) s)

--------------------------------------------------------------------------------
-- Translating typed RÏ‰ to untyped Mix.
--
-- These "flat" translations become indices to the translation of typed RÏ‰ to typed
-- Mix terms.

module Sym where

  -- read as "the translation of Îº *has sort* âŸ¦ Îº âŸ§Ïƒ"
  âŸ¦_âŸ§Ïƒ : (Îº : RÎ¼.Kind) â†’ Sort
  âŸ¦ â˜… âŸ§Ïƒ = ğ“¤
  âŸ¦ L âŸ§Ïƒ = ğ“¤
  âŸ¦ R[ Îº ] âŸ§Ïƒ = ğ“¤
  âŸ¦ Îº `â†’ Îºâ‚ âŸ§Ïƒ = â˜…

  -- read as "the translation of Îº to type âŸ¦ Îº âŸ§Îº"
  âŸ¦_âŸ§Îº : (Îº : RÎ¼.Kind) â†’  Term
  âŸ¦ â˜… âŸ§Îº = â˜…
  âŸ¦ L âŸ§Îº = â˜…
  âŸ¦ R[ Îº ] âŸ§Îº = Row âŸ¦ Îº âŸ§Îº
  âŸ¦ Îºâ‚ `â†’ Îºâ‚‚ âŸ§Îº = Î  âŸ¦ Îºâ‚ âŸ§Îº âŸ¦ Îºâ‚‚ âŸ§Îº

  âŸ¦_âŸ§Ï„ : âˆ€ {Î”}{Îº} â†’ RÎ¼.Type Î” Îº â†’ Term
  âŸ¦ U âŸ§Ï„ = âŠ¤
  âŸ¦_âŸ§Ï„ {.(_ , Îº)} {Îº} (tvar Z) = var 0 -- âŸ¦ Îº âŸ§Îº
  âŸ¦_âŸ§Ï„ {.(_ , _)} (tvar (S x)) = âŸ¦ tvar x âŸ§Ï„
  --
  âŸ¦ Ï„â‚ `â†’ Ï„â‚‚ âŸ§Ï„ = Î  âŸ¦ Ï„â‚ âŸ§Ï„ âŸ¦ Ï„â‚‚ âŸ§Ï„
  âŸ¦ `âˆ€ Îº Ï„ âŸ§Ï„ = Î  âŸ¦ Îº âŸ§Îº âŸ¦ Ï„ âŸ§Ï„
  âŸ¦ `Î» Îº Ï„ âŸ§Ï„ = `Î» âŸ¦ Îº âŸ§Îº âŸ¦ Ï„ âŸ§Ï„
  âŸ¦ Ï„â‚ Â·[ Ï„â‚‚ ] âŸ§Ï„ = âŸ¦ Ï„â‚ âŸ§Ï„ Â· âŸ¦ Ï„â‚‚ âŸ§Ï„
  --
  âŸ¦ lab l âŸ§Ï„ = tt
  âŸ¦ _ â–¹ Ï„ âŸ§Ï„ = âŸ¦ Ï„ âŸ§Ï„
  âŸ¦ _ Râ–¹ Ï„ âŸ§Ï„ = âŸª Suc Zero â¦‚ Nat , `Î» (Ix (var 0)) âŸ¦ Ï„ âŸ§Ï„ âŸ«
  âŸ¦ âŒŠ Ï„ âŒ‹ âŸ§Ï„ = âŠ¤
  âŸ¦_âŸ§Ï„ {Î”} Îµ = âŸª Zero â¦‚ Nat ,  `Î» (Ix (var 0)) âŠ¤ âŸ«
  âŸ¦ Î  Ï âŸ§Ï„ = Î  (Ix (fst âŸ¦ Ï âŸ§Ï„)) ((snd âŸ¦ Ï âŸ§Ï„) Â· var 0)
  âŸ¦ Î£ Ï âŸ§Ï„ = Î£ (Ix (fst âŸ¦ Ï âŸ§Ï„)) ((snd âŸ¦ Ï âŸ§Ï„) Â· var 0)
  âŸ¦ Ï„ Â·âŒˆ Ï„â‚ âŒ‰ âŸ§Ï„ = {!!}
  âŸ¦ âŒˆ Ï„ âŒ‰Â· Ï„â‚ âŸ§Ï„ = {!!}
  --
  âŸ¦ Ï€ â‡’ Ï„ âŸ§Ï„ = {!!}
  --
  âŸ¦ Î¼ Ï„ âŸ§Ï„ = {!!}
  âŸ¦ Î½ Ï„ âŸ§Ï„ = {!!}

  âŸ¦_âŸ§ : âˆ€ {Î”}{Î“}{Î¦}{Ï„} â†’ RÎ¼.Term Î” Î“ Î¦ Ï„ â†’ Term
  âŸ¦ M âŸ§ = {!!}

--------------------------------------------------------------------------------
-- Typed translation of kinds.

âŸ¦_âŸ§Îº : âˆ€ {Î”}{Ïƒ} â†’ (Îº : RÎ¼.Kind) â†’ Î” âŠ¢ Sym.âŸ¦ Îº âŸ§Îº â¦‚â‚› ğ“¤
âŸ¦ â˜… âŸ§Îº = â˜…
âŸ¦ L âŸ§Îº = â˜…
âŸ¦ R[ Îº ] âŸ§Îº = {!!} -- Î£ Nat (Î  (Ix varZ) âŸ¦ Îº âŸ§Îº) 
âŸ¦ Îºâ‚ `â†’ Îºâ‚‚ âŸ§Îº = {!!} -- Î  âŸ¦ Îºâ‚ âŸ§Îº (weaken âŸ¦ Îºâ‚‚ âŸ§Îº) 

-- -- --------------------------------------------------------------------------------
-- -- -- Typed translation of contexts.
âŸ¦_âŸ§Î” : RÎ¼.KEnv â†’ Context
âŸ¦ Îµ âŸ§Î” = Îµ
âŸ¦ Î” , Îº âŸ§Î” = âŸ¦ Î” âŸ§Î” , âŸ¦ Îº âŸ§Îº

-- -- --------------------------------------------------------------------------------
-- -- -- Typed translation of types.

-- âŸ¦_âŸ§v : âˆ€ {Î”}{Îº} â†’ (v : RÎ¼.TVar Î” Îº) â†’ âŸ¦ Î” âŸ§Î” âŠ¢ Sym.âŸ¦ (tvar v) âŸ§Ï„ â¦‚ Sym.âŸ¦ Îº âŸ§Îº
-- âŸ¦ Z âŸ§v = varZ
-- âŸ¦ S v âŸ§v = {!!}

âŸ¦_âŸ§Ï„ : âˆ€ {Î”}{Îº} â†’ (Ï„ : RÎ¼.Type Î” Îº) â†’ âŸ¦ Î” âŸ§Î” âŠ¢ Sym.âŸ¦ Ï„ âŸ§Ï„ â¦‚ Sym.âŸ¦ Îº âŸ§Îº
âŸ¦ U âŸ§Ï„ = {!!}
âŸ¦ lab l âŸ§Ï„ = {!tt!}

âŸ¦ tvar x âŸ§Ï„ = {!!}
-- âŸ¦ Ï„â‚ `â†’ Ï„â‚‚ âŸ§Ï„ = Î  âŸ¦ Ï„â‚ âŸ§Ï„ (weaken âŸ¦ Ï„â‚‚ âŸ§Ï„)
-- âŸ¦ `âˆ€ Îº Ï„ âŸ§Ï„ = Î  âŸ¦ Îº âŸ§Îº âŸ¦ Ï„ âŸ§Ï„
-- âŸ¦ `Î» Îº Ï„ âŸ§Ï„ = `Î» âŸ¦ Îº âŸ§Îº {!!} -- âŸ¦ Ï„ âŸ§Ï„
-- âŸ¦ Ï„â‚ Â·[ Ï„â‚‚ ] âŸ§Ï„ = âŸ¦ Ï„â‚ âŸ§Ï„ Â· âŸ¦ Ï„â‚‚ âŸ§Ï„
-- --
-- âŸ¦ lab l âŸ§Ï„ = tt
-- âŸ¦ _ â–¹ Ï„ âŸ§Ï„ = âŸ¦ Ï„ âŸ§Ï„
-- âŸ¦ _ Râ–¹ Ï„ âŸ§Ï„ = âŸª (Suc Zero) â¦‚ Nat , `Î» (Ix varZ) (weaken (weaken {!!})) âŸ« -- âŸª (Suc Zero) â¦‚ Nat , (Î  (Ix varZ) {!âŸ¦ Ï„ âŸ§Ï„!}) âŸ« 
-- âŸ¦ âŒŠ Ï„ âŒ‹ âŸ§Ï„ = âŠ¤ â˜…
-- -- I need to actually do substitution.
-- âŸ¦ Îµ âŸ§Ï„ = âŸª Zero â¦‚ Nat , `Î» (Ix varZ) (âŠ¤ â˜…) âŸ«
-- -- I need renaming in symbol expressions.
-- âŸ¦ Î  Ï„ âŸ§Ï„ = Î  (Ix (fst âŸ¦ Ï„ âŸ§Ï„)) (snd (weaken (âŸ¦ Ï„ âŸ§Ï„)) Â· {!varZ!})
-- âŸ¦ Î£ Ï„ âŸ§Ï„ = Î£ {!!} ({!!} Â· {!!})
-- âŸ¦ Ï„ Â·âŒˆ Ï„â‚ âŒ‰ âŸ§Ï„ = {!!}
-- âŸ¦ âŒˆ Ï„ âŒ‰Â· Ï„â‚ âŸ§Ï„ = {!!}

-- âŸ¦ Î¼ Ï„ âŸ§Ï„ = {!!}
-- âŸ¦ Î½ Ï„ âŸ§Ï„ = {!!}

-- âŸ¦ Ï€ â‡’ Ï„ âŸ§Ï„ = {!!}
